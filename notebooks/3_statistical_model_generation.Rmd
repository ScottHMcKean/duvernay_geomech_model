---
title: "Untitled"
author: "Scott McKean"
date: "10/8/2019"
output: html_document
---

```{r setup}
library(duvernaygeomechmodel)
set.seed(1)
```

Load datasets, encode factors, and set brittleness with residual data

```{r}
mldf_nores = read_csv("../data/merged_tests_no_residual.csv") %>%
  mutate(horiz_orient = ifelse(orientation == 'horizontal', 1, 0)) %>%
  mutate(shale_group = ifelse(group == 'shale', 1, 0))

mldf_wres = read_csv("../data/merged_tests_w_residual.csv") %>%
  mutate(brittleness = (peak_stress_dev - residual_stress_dev)/peak_stress_dev) %>%
  mutate(horiz_orient = ifelse(orientation == 'horizontal', 1, 0)) %>%
  mutate(shale_group = ifelse(group == 'shale', 1, 0))
```
Set auxiliary columns and targets

```{r}
aux_cols <- c("well", "round_depth", "se_vp", "se_vs", "se_vp_per", "se_vs_per")
targets <- c("youngs_modulus", "poisson_ratio", "brittleness")
```

```{r}
generate_models(feats = c('pred_vp', 'bulk_density'), feat_suffix = 'vp_rho')

```

The following functions generate models for Young's Modulus:
- YM - All features - GLM
- YM - No Group - GLM
- YM - No VS - GLM
- YM - All features - MARS
- YM - No Group - MARS
- YM - No VS - MARS
- YM - All features - Random Forest
- YM - No Group - Random Forest
- YM - No VS - Random Forest

```{r}
# YM - No shale_group - Random Forest


# YM - No shale_group, No VS - Random Forest
generate_model(data = mldf_nores,
  target = "youngs_modulus",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'ym_rf_novs'
  )
```

The following functions generate models for Poisson's Ratio:
- PR - All features - GLM
- PR - No shale_group - GLM
- PR - No VS - GLM
- PR - All features - MARS
- PR - No shale_group - MARS
- PR - No VS - MARS
- PR - All features - Random Forest
- PR - No shale_group - Random Forest
- PR - No VS - Random Forest

```{r}
# YM - All features - GLM
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'pr_glm_all'
  )

# YM - No shale_group - GLM
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'pr_glm_noshale_group'
  )

# YM - No VS - GLM
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vp', 
    "bulk_density", "deviatoric_stress", "shale_group"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'pr_glm_novs'
  )

# YM - All features - MARS
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 10)
    ),
  prefix = 'pr_mars_all'
  )

# YM - No shale_group - MARS
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 10)
    ),
  prefix = 'pr_mars_noshale_group'
  )

# YM - No shale_group, No VS - MARS
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 10)
    ),
  prefix = 'pr_mars_novs'
  )

# YM - All features - Random Forest
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'pr_rf_all'
  )

# YM - No shale_group - Random Forest
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'pr_rf_noshale_group'
  )

# YM - No shale_group, No VS - Random Forest
generate_model(data = mldf_nores,
  target = "poisson_ratio",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'pr_rf_novs'
  )
```


The following functions generate models for Brittleness:
- BR - All features - GLM
- BR - No shale_group - GLM
- BR - No VS - GLM
- BR - All features - MARS
- BR - No shale_group - MARS
- BR - No VS - MARS
- BR - All features - Random Forest
- BR - No shale_group - Random Forest
- BR - No VS - Random Forest

```{r}
# YM - All features - GLM
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'br_glm_all'
  )

# YM - No shale_group - GLM
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'br_glm_noshale_group'
  )

# YM - No VS - GLM
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vp', 
    "bulk_density", "deviatoric_stress", "shale_group"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'br_glm_novs'
  )

# YM - All features - MARS
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 10)
    ),
  prefix = 'br_mars_all'
  )

# YM - No shale_group - MARS
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 10)
    ),
  prefix = 'br_mars_noshale_group'
  )

# YM - No shale_group, No VS - MARS
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 10)
    ),
  prefix = 'br_mars_novs'
  )

# YM - All features - Random Forest
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'br_rf_all'
  )

# YM - No shale_group - Random Forest
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'br_rf_noshale_group'
  )

# YM - No shale_group, No VS - Random Forest
generate_model(data = mldf_wres,
  target = "brittleness",
  features =  c(
    "horiz_orient", "confining_pressure", 'pred_vp', 
    "bulk_density", "shale_group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'br_rf_novs'
  )
```
