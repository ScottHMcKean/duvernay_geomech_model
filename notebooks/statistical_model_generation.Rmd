---
title: "Untitled"
author: "Scott McKean"
date: "10/8/2019"
output: html_document
---

```{r setup}
library(duvernaygeomechmodel)
set.seed(1)
```

Load datasets, encode factors, and set brittleness with residual data

```{r}
mldf_nores = read_csv("../data/merged_tests_no_residual.csv") %>%
  mutate(orientation = as.factor(orientation)) %>%
  mutate(group = as.factor(group))

mldf_wres = read_csv("../data/merged_tests_w_residual.csv") %>%
  mutate(brittleness = (peak_stress_dev - residual_stress_dev)/peak_stress_dev) %>%
  mutate(orientation = as.factor(orientation)) %>%
  mutate(group = as.factor(group))
```

Set features

```{r}
aux_cols <- c("well", "round_depth", "se_vp", "se_vs", "se_vp_per", "se_vs_per")

features <- c("orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
              "bulk_density", "group", "deviatoric_stress")

targets <- c("youngs_modulus", "poisson_ratio", "brittleness")
```

The following functions generate models for Young's Modulus:
- YM - All features - GLM
- YM - No Group - GLM
- YM - No VS - GLM
- YM - All features - MARS
- YM - No Group - MARS
- YM - No VS - MARS
- YM - All features - Random Forest
- YM - No Group - Random Forest
- YM - No VS - Random Forest

```{r}
# YM - All features - GLM
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'ym_glm_all'
  )

# YM - No Group - GLM
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'ym_glm_nogroup'
  )

# YM - No VS - GLM
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "deviatoric_stress", "group"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'ym_glm_novs'
  )

# YM - All features - MARS
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'ym_mars_all'
  )

# YM - No Group - MARS
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'ym_mars_nogroup'
  )

# YM - No Group, No VS - MARS
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'ym_mars_novs'
  )

# YM - All features - Random Forest
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'ym_rf_all'
  )

# YM - No Group - Random Forest
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'ym_rf_nogroup'
  )

# YM - No Group, No VS - Random Forest
generate_model(
  target = "youngs_modulus",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'ym_rf_novs'
  )
```

The following functions generate models for Poisson's Ratio:
- PR - All features - GLM
- PR - No Group - GLM
- PR - No VS - GLM
- PR - All features - MARS
- PR - No Group - MARS
- PR - No VS - MARS
- PR - All features - Random Forest
- PR - No Group - Random Forest
- PR - No VS - Random Forest

```{r}
# YM - All features - GLM
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'pr_glm_all'
  )

# YM - No Group - GLM
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'pr_glm_nogroup'
  )

# YM - No VS - GLM
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "deviatoric_stress", "group"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'pr_glm_novs'
  )

# YM - All features - MARS
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'pr_mars_all'
  )

# YM - No Group - MARS
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'pr_mars_nogroup'
  )

# YM - No Group, No VS - MARS
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'pr_mars_novs'
  )

# YM - All features - Random Forest
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'pr_rf_all'
  )

# YM - No Group - Random Forest
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'pr_rf_nogroup'
  )

# YM - No Group, No VS - Random Forest
generate_model(
  target = "poisson_ratio",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'pr_rf_novs'
  )
```


The following functions generate models for Brittleness:
- BR - All features - GLM
- BR - No Group - GLM
- BR - No VS - GLM
- BR - All features - MARS
- BR - No Group - MARS
- BR - No VS - MARS
- BR - All features - Random Forest
- BR - No Group - Random Forest
- BR - No VS - Random Forest

```{r}
# YM - All features - GLM
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'br_glm_all'
  )

# YM - No Group - GLM
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'br_glm_nogroup'
  )

# YM - No VS - GLM
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "deviatoric_stress", "group"
    ),
  model_type = "regr.glmnet",
  pset= makeParamSet(
    makeNumericParam('alpha',lower = 0, upper = 1),
    makeIntegerParam('lambda', lower = -4, upper = 1, trafo = function(x) 10^x)
    ),
  prefix = 'br_glm_novs'
  )

# YM - All features - MARS
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'br_mars_all'
  )

# YM - No Group - MARS
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'br_mars_nogroup'
  )

# YM - No Group, No VS - MARS
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.mars",
  pset= makeParamSet(
    makeDiscreteParam('degree',values=c(1,2,3)),
    makeIntegerParam('nk', lower = 1, upper = 30)
    ),
  prefix = 'br_mars_novs'
  )

# YM - All features - Random Forest
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'br_rf_all'
  )

# YM - No Group - Random Forest
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vs', 'pred_vp', 
    "bulk_density", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'br_rf_nogroup'
  )

# YM - No Group, No VS - Random Forest
generate_model(
  target = "brittleness",
  features =  c(
    "orientation", "confining_pressure", 'pred_vp', 
    "bulk_density", "group", "deviatoric_stress"
    ),
  model_type = "regr.ranger",
  pset= makeParamSet(
    makeIntegerParam('mtry', lower = 1L, upper = 6L),
    makeIntegerParam('num.trees', lower = 10L, upper = 200L),
    makeIntegerParam('min.node.size', lower = 0, upper = 1, trafo = function(x) 80^x),
    makeNumericParam('sample.fraction', lower = 0.2, upper = 0.9)
  ),
  prefix = 'br_rf_novs'
  )
```
